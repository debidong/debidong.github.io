<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Everything about HTTPS - debidong's site</title><meta name=Description content="Classic Interviewer: Tell me how the client and server work when sending HTTPS!"><meta property="og:title" content="Everything about HTTPS"><meta property="og:description" content="Classic Interviewer: Tell me how the client and server work when sending HTTPS!"><meta property="og:type" content="article"><meta property="og:url" content="http://www.debidong.github.io/posts/everything-about-https/"><meta property="og:image" content="http://www.debidong.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-21T15:00:00+08:00"><meta property="article:modified_time" content="2023-10-21T15:00:00+08:00"><meta property="og:site_name" content="debidong's site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://www.debidong.github.io/logo.png"><meta name=twitter:title content="Everything about HTTPS"><meta name=twitter:description content="Classic Interviewer: Tell me how the client and server work when sending HTTPS!"><meta name=application-name content="debidong's site"><meta name=apple-mobile-web-app-title content="debidong's site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://www.debidong.github.io/posts/everything-about-https/><link rel=prev href=http://www.debidong.github.io/posts/sqli/><link rel=next href=http://www.debidong.github.io/posts/writeup-for-orgctf2-crypto/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Everything about HTTPS","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/www.debidong.github.io\/posts\/everything-about-https\/"},"genre":"posts","keywords":"TCP\/IP, HTTPS","wordcount":1309,"url":"http:\/\/www.debidong.github.io\/posts\/everything-about-https\/","datePublished":"2023-10-21T15:00:00+08:00","dateModified":"2023-10-21T15:00:00+08:00","license":"debidong","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"debidong"},"description":"Classic Interviewer: Tell me how the client and server work when sending HTTPS!"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="debidong's site">debidong's site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="debidong's site">debidong's site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Everything about HTTPS</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=www.debidong.github.io title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>debidong</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-10-21>2023-10-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1309 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;7 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-the-internet-before-http>1 The Internet Before HTTP</a></li><li><a href=#2-http>2 HTTP</a><ul><li><a href=#21-http-versions>2.1 HTTP Versions</a></li><li><a href=#22-standard-format-of-requests-and-responses>2.2 Standard Format of Requests and Responses</a></li></ul></li><li><a href=#3-https>3 HTTPS</a></li></ul></nav></div></div><div class=content id=content><p>During my experience of this year&rsquo;s fall job application process, many interviewers asked questions about HTTPS like such:</p><blockquote><ul><li>How is the security of HTTPS implemented compared to HTTP?</li><li>In the HTTPS protocol, how is data transmitted?</li><li>What are the steps of HTTPS?</li><li>(A speechless question) What advantages does ECDH have over HTTPS?</li></ul></blockquote><p>These interviews told me that it&rsquo;s necessary to delve deeper into HTTPS. However, before we get into HTTPS, it&rsquo;s important to understand its predecessor, HTTP.</p><h2 id=1-the-internet-before-http>1 The Internet Before HTTP</h2><p>Before the World Wide Web and HTTP came into existence, people used <a href=https://en.wikipedia.org/wiki/Gopher target=_blank rel="noopener noreffer">Gopher</a> for communication between networks.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/220px-Pocket-Gopher_Ano-Nuevo-SP.jpg data-srcset="./assets/220px-Pocket-Gopher_Ano-Nuevo-SP.jpg, ./assets/220px-Pocket-Gopher_Ano-Nuevo-SP.jpg 1.5x, ./assets/220px-Pocket-Gopher_Ano-Nuevo-SP.jpg 2x" data-sizes=auto alt=./assets/220px-Pocket-Gopher_Ano-Nuevo-SP.jpg title=img></p><p>As you can see, Gopher seems to refer to a type of rodent skilled at digging holes. These rodents were good at digging tunnels underground, much like networks. I&rsquo;m not sure whether the name &ldquo;Gopher&rdquo; in the computer industry is related to these animals.</p><p>The Gopher protocol was a communication protocol used for distributing, searching, and retrieving documents on the Internet protocol network. The Gopher protocol and user interface design were menu-driven and offered an alternative to the early stages of the World Wide Web but were eventually replaced by HTTP. (Gopher is not free!)</p><p>The working process of the Gopher protocol is roughly as follows:</p><ol><li><p>The client establishes a TCP connection with the server on port 70 (the standard Gopher port).</p></li><li><p>The client sends a string (the directory of the document to retrieve), followed by a carriage return and line feed (CR + LF).</p></li><li><p>The server replies with the requested items and closes the connection.</p></li></ol><p>Even today, some intranets still use the Gopher protocol, but improper deployment can lead to SSRF vulnerabilities.</p><h2 id=2-http>2 HTTP</h2><blockquote><p>Hypertext Transfer Protocol is an application layer protocol for distributed, collaborative, and hypermedia information systems. HTTP is the foundation for data communication on the World Wide Web.</p></blockquote><p>The initial purpose of designing HTTP was to provide a way to publish and receive HTML pages. Resources requested via the HTTP or HTTPS protocol are identified by Uniform Resource Identifiers (URIs).</p><p>HTTP is a standard for requests and responses between a client (user) and a server (website), usually using the TCP protocol. The client initiates an HTTP request to the server on a specified port (the default port is 80). We refer to this client as the user agent, which can include web browsers, web crawlers, and more. Resources requested via HTTP or HTTPS are identified by Uniform Resource Identifiers (URIs).</p><p>The HTTP client initiates a request by establishing a TCP connection to the server on a specified port (typically 80 for HTTP, 443 for HTTPS). The HTTP server listens on that port for client requests. Once a request is received, the server responds with a status along with the requested content, error messages, or other information.</p><h3 id=21-http-versions>2.1 HTTP Versions</h3><p>The development of HTTP versions is as follows:</p><ul><li><p>HTTP/0.9: Supports only the <code>GET</code> method, does not specify a version in communication, and does not support request headers.</p></li><li><p>HTTP/1.0: The first HTTP version with a version number, default <code>Connection: close</code>.</p><p>Each HTTP operation results in a connection being established, but the connection is terminated when the task is complete. A new HTTP session is established for each request for a web resource.</p></li><li><p>HTTP/1.1: Default <code>Connection: keep-alive</code>.</p><p>In HTTP/1.1, the connection between the client and server does not close after a web page is opened. If the client accesses another web page on the same server, the existing connection is reused. Connection has a keep-alive time, and it can be configured in server software like Apache. Implementing a persistent connection requires both client and server support. <strong>The concept of long and short connections in HTTP is essentially related to long and short connections in TCP.</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/TCP_3way_4way_Handshake.png data-srcset="./assets/TCP_3way_4way_Handshake.png, ./assets/TCP_3way_4way_Handshake.png 1.5x, ./assets/TCP_3way_4way_Handshake.png 2x" data-sizes=auto alt=./assets/TCP_3way_4way_Handshake.png title=TCP_3way_4way_Handshake></p></li><li><p>HTTP/2</p></li><li><p>HTTP/3: Abandons TCP and uses QUIC over UDP for carrying application-layer data.</p></li></ul><p>As of now, HTTP/1.1 is still the most widely used version (from my personal observation).</p><p>HTTP/1.1 defines eight methods to operate on specified resources in different ways.</p><table><thead><tr><th style=text-align:center>Request Method</th><th style=text-align:center>Request Has Payload Body</th><th style=text-align:center>Response Has Payload Body</th></tr></thead><tbody><tr><td style=text-align:center>GET</td><td style=text-align:center>Optional</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>HEAD</td><td style=text-align:center>Optional</td><td style=text-align:center>No</td></tr><tr><td style=text-align:center>POST</td><td style=text-align:center>Yes</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>PUT</td><td style=text-align:center>Yes</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>DELETE</td><td style=text-align:center>Optional</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>CONNECT</td><td style=text-align:center>Optional</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>OPTIONS</td><td style=text-align:center>Optional</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>TRACE</td><td style=text-align:center>No</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>PATCH</td><td style=text-align:center>Yes</td><td style=text-align:center>Yes</td></tr></tbody></table><h3 id=22-standard-format-of-requests-and-responses>2.2 Standard Format of Requests and Responses</h3><table><thead><tr><th>Request</th><th>Response</th></tr></thead><tbody><tr><td>Request Line (Request Method + Address + HTTP Version) + <code>&lt;CR>&lt;LF></code></td><td>Response Line (Response Code) + <code>&lt;CR>&lt;LF></code></td></tr><tr><td>Request Header + <code>&lt;CR>&lt;LF></code></td><td>Response Header + <code>&lt;CR>&lt;LF></code></td></tr><tr><td><code>&lt;CR>&lt;LF></code></td><td><code>&lt;CR>&lt;LF></code></td></tr><tr><td>Other Message Body</td><td>Other Message Body</td></tr></tbody></table><h2 id=3-https>3 HTTPS</h2><p>Hypertext Transfer Protocol Secure (often referred to as HTTP over TLS, HTTP over SSL, or HTTP Secure) is a transport protocol for secure communication over a computer network. HTTPS uses HTTP for communication but encrypts the data using SSL/TLS.</p><p>TLS is the child of SSL. Strictly speaking, the HTTPS we use today is based on TLS, not SSL. The latest version of SSL was deprecated in 2015.</p><p>Application layer protocols can transparently run over the TLS protocol, which is responsible for negotiating and authenticating the establishment of an encrypted channel. Data transmitted by application layer protocols is encrypted when passing through the TLS protocol, ensuring the privacy of communication.</p><p>The TLS protocol is optional and must be configured on both the client and server to be used. There are two main ways to achieve this: one is to use a common TLS protocol port (e.g., port 443 for HTTPS), and the other is for the client to request the server to use a specific protocol mechanism when connecting to TLS (e.g., commonly used STARTTLS in email). Once both the client and server agree to use the TLS protocol, they negotiate a stateful connection to transmit data.</p><p><strong>Steps in the TLS handshake (key exchange, using RSA as an example):</strong></p><ol><li><p>The client requests a TLS connection with the server.</p></li><li><p>The server decides the cipher suite from a list and notifies the client.</p></li><li><p>The server sends back its digital certificate, including the server&rsquo;s public key.</p></li><li><p>The client verifies the validity of the certificate issued.</p></li><li><p>To generate a session key for a secure connection, the client encrypts a randomly generated key (used for symmetric encryption, currently 2048 bits, very secure) using the server&rsquo;s public key and sends it to the server.</p></li><li><p>The server decrypts the client&rsquo;s symmetrically encrypted key using its private key. Handshake complete.</p></li></ol><p>During the key exchange process, other methods can be used: ECDH, DH, DHE, ECDHE, DH_anon.</p><p>Among these algorithms, some are <strong>forward-secure</strong>, while others are not. Forward secrecy is a security feature in cryptographic communication protocols. It means that even if the long-term master key is compromised, it won&rsquo;t lead to the exposure of past session keys. <strong>RSA doesn&rsquo;t have forward secrecy.</strong> In the case of ECDH and DH, both parties generate a shared key using their public keys and their respective private keys. They then deleted their private keys and use a hash of the shared key as the AES key. Even if an attacker obtains the AES key, they can&rsquo;t recover the server&rsquo;s DH private key (which had been deleted in the two sides).</p><blockquote><p>Well, so let&rsquo;s discuss the question from the very beginning:</p><p><em>What advantages does ECDH have over <del>HTTPS</del> RSA?</em></p><p>Because ECDH is based on elliptic curves, it offers the advantages of <strong>smaller key sizes</strong>, <strong>faster encryption and decryption speeds</strong>, <strong>lower computational resource requirements</strong>, and of course, <strong>forward secrecy</strong>.</p><p>However, ECDH requires high-quality random number generation to ensure the security of the keys. Additionally, careless selection or implementation of curves can result in potential security vulnerabilities. (On the other hand, when configured improperly, RSA has its share of security issues as well&mldr;)</p></blockquote><p>After the TLS handshake, both parties will use symmetric encryption to transmit data. Since application layer protocols can transparently run over the TLS protocol, the encryption and handshake process is transparent to us. When we send an HTTPS request, we are still using plain text, but the destination port for the request is 443 instead of 80.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/image.png data-srcset="./assets/image.png, ./assets/image.png 1.5x, ./assets/image.png 2x" data-sizes=auto alt=./assets/image.png title="HOW DOES HTTPS WORK"></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-10-21</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/tcp/ip/>TCP/IP</a>,&nbsp;<a href=/tags/https/>HTTPS</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/sqli/ class=prev rel=prev title=SQLi><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>SQLi</a>
<a href=/posts/writeup-for-orgctf2-crypto/ class=next rel=next title="Writeup for ORGCTF2: Crypto.my_own_cryptography">Writeup for ORGCTF2: Crypto.my_own_cryptography<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=www.debidong.github.io target=_blank>debidong</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>