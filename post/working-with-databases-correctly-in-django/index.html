<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Working With Databases Correctly in Django - debidong&#39;s site</title><meta name="Description" content="1. Introduction of ORM and lazy evaulation.
 2. Using built-in exceptions for queries in Django."><meta property="og:title" content="Working With Databases Correctly in Django" />
<meta property="og:description" content="1. Introduction of ORM and lazy evaulation.
 2. Using built-in exceptions for queries in Django." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.debidong.github.io/post/working-with-databases-correctly-in-django/" /><meta property="og:image" content="http://www.debidong.github.io/logo.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-08-16T17:00:00+08:00" />
<meta property="article:modified_time" content="2023-08-16T17:00:00+08:00" /><meta property="og:site_name" content="debidong&#39;s site" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://www.debidong.github.io/logo.png"/>

<meta name="twitter:title" content="Working With Databases Correctly in Django"/>
<meta name="twitter:description" content="1. Introduction of ORM and lazy evaulation.
 2. Using built-in exceptions for queries in Django."/>
<meta name="application-name" content="debidong&#39;s site">
<meta name="apple-mobile-web-app-title" content="debidong&#39;s site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://www.debidong.github.io/post/working-with-databases-correctly-in-django/" /><link rel="prev" href="http://www.debidong.github.io/post/why-cybersecurity/" /><link rel="next" href="http://www.debidong.github.io/post/file-upload-vulnerability/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Working With Databases Correctly in Django",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/www.debidong.github.io\/post\/working-with-databases-correctly-in-django\/"
        },"genre": "post","keywords": "Django, backend","wordcount":  989 ,
        "url": "http:\/\/www.debidong.github.io\/post\/working-with-databases-correctly-in-django\/","datePublished": "2023-08-16T17:00:00+08:00","dateModified": "2023-08-16T17:00:00+08:00","license": "debidong","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "debidong"
            },"description": "1. Introduction of ORM and lazy evaulation.\n 2. Using built-in exceptions for queries in Django."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="debidong&#39;s site">debidong&#39;s site</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="debidong&#39;s site">debidong&#39;s site</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Working With Databases Correctly in Django</h1><div class="content" id="content"><h2 id="1-what-is-orm">1 What is ORM</h2>
<p>The main function of ORM (Object Relational Mapping) is to associate data with tables in the database in programming. ORM converts different types of data into objects in the database, and at the same time provides methods to interact with the objects. The following is an introduction to the ORM of Django.</p>
<blockquote>
<p>Djangoâ€™s Object-Relational Model or ORM provides a great productivity shortcut: not only generating decent SQL queries for common use cases, but providing model access/update functionality that comes complete with validation and security.</p>
<p>The Django ORM, like any ORM, converts data from different types into objects that we can use pretty consistently across supported databases. Then it provides a set of methods for interacting with those objects.</p>
<p><em>- Two Scoops of Django</em></p>
</blockquote>
<p>Thanks to ORM, we can access the database without writing complex SQL statements. Handwritten SQL code may also have a major security risk-<strong>SQL injection</strong>. In order to avoid the above problems, it is recommended to use a mature and secure framework like Django to operate the database.</p>
<h2 id="2-handling-exceptions">2 Handling exceptions</h2>
<p>Django&rsquo;s <code>objects.get()</code> method is used to try to get a record that meets the criteria. <code>objects.get()</code> will throw an exception if the database does not contain or contains multiple eligible records. If you don&rsquo;t want to use <code>objects.filter()</code> to get <code>QuerySet</code> and then use <code>objects.filter().exists()</code> to judge the query result, you can use exceptions defined by Django.</p>
<p>First let&rsquo;s define a <code>model</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># models.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   	<span class="n">sex_choices</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="s2">&#34;O&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sex</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SEX_CHOICES</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">friend</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">symmetrical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="21-no-record-in-database">2.1 No record in database</h3>
<p>In Django, the <code>get()</code> function is used to query a database model and return a single object (record) that meets the query criteria. The <code>get()</code> function will raise an exception if the query condition matches more than one object, or if no object matches the query condition. In order to facilitate the handling of the case where the query object does not exist, you can use <code>ObjectDoesNotExist</code> or <code>DoesNotExist</code> to throw an exception and then handle it.</p>
<p><code>ObjectDoesNotExist</code> can be used for any <code>model</code>, however <code>DoesNotExist</code> can only be used for a specific <code>model</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExists</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span></code></pre></div><h3 id="22-multiple-records-in-database">2.2 Multiple records in database</h3>
<p>Django also provides <code>MultipleObjectsReturned</code> exception to deal with this situation.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExists</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Note here</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="3-complex-query">3 Complex query</h2>
<blockquote>
<p>Django supports negation, addition, subtraction, multiplication, division, modulo arithmetic, and the power operator on query expressions, using Python constants, variables, and even other expressions.</p>
<p><em>- Django Documentation</em></p>
</blockquote>
<p>In Django, <code>django.db.models.Q</code> is an object used to build complex query conditions. It can be used to create logical connections between multiple conditions, such as <code>AND</code> and <code>OR</code>, allowing for more flexibility in building database queries. The <code>Q</code> object allows you to programmatically build complex query expressions instead of simple filter conditions. Typically, <code>Q</code> objects are used to create complex query conditions in <code>filter()</code> or <code>exclude()</code> functions.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Operation</th>
<th>Operator</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">AND</td>
<td><code>&amp;</code></td>
</tr>
<tr>
<td style="text-align:left">OR</td>
<td><code>|</code></td>
</tr>
<tr>
<td style="text-align:left">NOT</td>
<td><code>~</code></td>
</tr>
<tr>
<td style="text-align:left">XOR</td>
<td><code>^</code></td>
</tr>
</tbody>
</table>
<p>In addition to logical operations, Django provides various expressions for comparison and filter operations. Some common expressions are given below.</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Operator</th>
</tr>
</thead>
<tbody>
<tr>
<td>Less than</td>
<td><code>__lt</code></td>
</tr>
<tr>
<td>Greater than</td>
<td><code>__gt</code></td>
</tr>
<tr>
<td>Less than or equal to</td>
<td><code>__lte</code></td>
</tr>
<tr>
<td>Greater than or equal to</td>
<td><code>__gte</code></td>
</tr>
<tr>
<td>Exact match (string)</td>
<td><code>__exact</code></td>
</tr>
<tr>
<td>Non-exact match (string)</td>
<td><code>__iexact</code></td>
</tr>
</tbody>
</table>
<p>Let&rsquo;s illustrate with an example. Query records for <em>males</em> over the age of <em>18</em>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># male age greater than 18</span>
</span></span><span class="line"><span class="cl"><span class="c1"># query is an instance of object Q</span>
</span></span><span class="line"><span class="cl"><span class="n">query</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">age__gt</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Q</span><span class="p">(</span><span class="n">sex</span><span class="o">=</span><span class="s2">&#34;M&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>Use the <code>Q</code> object as the parameter of <code>filter()</code> to get a <code>QuerySet</code>, which is a collection of indexes of all eligible objects.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># users is QuerySet, which contains references of returned objects</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="4-lazy-evaluation">4 Lazy evaluation</h2>
<p>Lazy evaluation is represented by <strong>until it is needed and then calculated</strong>, and Django&rsquo;s ORM also provides this feature. When we use a long list of query statements to query records in the database, Django will not execute the query operation until we actually operate the query results, and we don&rsquo;t have to access the database over and over again every time we modify the query . Lazy evaluation can optimize performance by implicitly aggregating all operations into one to avoid multiple operations. Based on this mechanism, we can also divide the query statement into multiple lines, thereby increasing the readability and maintainability of the code, without worrying that doing so will affect query performance.</p>
<p>Let&rsquo;s write a more complex example based on the example in <em>3 Complex query</em>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py, not ok</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">age__gt</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Q</span><span class="p">(</span><span class="n">sex</span><span class="o">=</span><span class="s2">&#34;M&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="s2">&#34;bob&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;Bob Dylan&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span></code></pre></div><p>Writing code like this is too difficult to maintain. For readability it can be written like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py, ok</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">		<span class="o">.</span><span class="n">objects</span>
</span></span><span class="line"><span class="cl">		<span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">Q</span><span class="p">(</span><span class="n">age__gt</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> 
</span></span><span class="line"><span class="cl">			<span class="n">Q</span><span class="p">(</span><span class="n">sex</span><span class="o">=</span><span class="s2">&#34;M&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="s2">&#34;bob&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;Bob Dylan&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span></code></pre></div><p>It&rsquo;s kind of ugly to write that. And because of the characteristics of lazy calculation, we can write like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py, better</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">age__gt</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Q</span><span class="p">(</span><span class="n">sex</span><span class="o">=</span><span class="s2">&#34;M&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="n">include</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="s2">&#34;bob&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;Bob Dylan&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Django will touch the database at this moment</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span></code></pre></div><p>Django will only execute the query operation when actually calling the object in the database (executing the <code>print()</code> statement). In this way, we can reduce the number of accesses to the database while ensuring the maintainability and readability of the code.</p>
<h2 id="5-reference">5 Reference</h2>
<p>For more details, please refer to the Django documentation.</p>
<ol>
<li>
<p><a href="https://docs.djangoproject.com/en/4.2/ref/models/fields/#choices" target="_blank" rel="noopener noreffer ">Model Field Reference</a></p>
</li>
<li>
<p><a href="https://docs.djangoproject.com/en/4.2/ref/models/expressions/" target="_blank" rel="noopener noreffer ">Query Expressions</a></p>
</li>
</ol>
</div></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="www.debidong.github.io" target="_blank">debidong</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
